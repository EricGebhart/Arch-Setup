#!/bin/bash

# meta packages
#---------------
# devel - clojure, leiningen, python, perl, etc.
# emacs - emacs, hunspell, languagetool, mu4e, isync, silver-surfer
# mobile-studio-pro  - nvidia, hi DPI settings.
# natural-language - languagetool, hunspell dictionaries,...
# necessities  - basic stuff everyone should have.
# tablet - krita, gimp, cellwriter, easystroke, onboard, Xournal
# X11 - xorg, xorg-apps, ...
# X11-apps - libreoffice, vivaldi, etc.
# Xfce - xfce4, xfce4-goodies, network-manager-applet.
# Xmonad - xmonad, haskell, xfce4-panel, network-manager-applet.

# setup repos.
#----------------
# emacs-setup
# xmonad-setup
# dotfiles
# bc-extensions
# xmonad-log-applet

function install_pkg {
    cd arch-pkgs/$1; makepkg -si; cd -
}

function install_repo {
    cd $1
    make ${2-install}
    cd -
}

function install_X11 {
    install_pkg X11
    install_pkg X11-apps
    install_aur_Xapps
}

function install_xmonad {
    echo "Installing Xmonad and setup"
    install_pkg Xmonad
    install_repo xmonad-setup
    install_repo xmonad-setup xsession
    cd xmonad-log-applet; make && sudo make install; cd -
}

function install_aur_Xapps {
    depends=(yacreader vivaldi vivaldi-codecs-ffmpeg-extra-bin)
    yay -S $depends
}

function install_emacs {
    # install emacs and accomplices
    install_pkg emacs
    # install mu.
    yay -S mu-git
    # will attempt to copy mu4e site-lisp...
    install_repo emacs-setup all
}

function install_necessities {
    echo "Installing necessities"
    install_pkg necessities
    install_pkg yay
}

function install_dotfiles {
    # install dotfiles, etc.
    install_repo dotfiles
    install_repo bc-extensions
}

function install_xfce {
    echo "Installing Xfce4"
    install_pkg xfce
}

function install_devel {
    echo "Installing dev tools"
    install_pkg devel
}

function install_tablet {
    echo "Installing dev tools"
    install_pkg tablet
}

function install_nat_language {
    echo "Installing Natural language stuff"
    install_pkg natural-language
}

function install_MBP {
    echo "Installing mobile studio pro, nvidia, hidpi.."
    install_pkg mobile-studio-pro
    install_repo dotfiles hidpi
}

function install_hidpi {
    echo "adding high DPI settings to .Xresources."
    install_repo dotfiles hidpi
}

### Set up logging ###
exec 1> >(tee "pkg-install.log")
exec 2> >(tee "pkg-install.log")

# create a menu.
cmd=(dialog --stdout --separate-output --checklist "Select Packages to install" 22 77 16)
         options=(
             1 "Necessities - utilities, yay, etc." on
             2 "X11"    on
             3 "Xmonad" on
             4 "dot files" on
             5 "Emacs setup"  on
             6 "Xfce"   off
             7 "clojure, python, etc."  on
             8 "Tablet - Pen stuff - krita, cellwriter, onboard..." on
             9 "Natural language - hunspell, languagetool, ..."   on
             10 "Mobile Studio Pro"  off
             11 "High DPI screen, Resolution 3840x2160"    on
             12 "All"    off )

         # display menu and get the choices
         choices=$("${cmd[@]}" "${options[@]}")
         # clear

         for choice in ${choices[@]}
         do
             case $choice in
                 1)
                     install_necessities
                     ;;
                 2)
                     install_X11
                     ;;
                 3)
                     install_xmonad
                     ;;
                 4)
                     install_dotfiles
                     ;;
                 5)
                     install_emacs
                     ;;
                 6)
                     install_xfce
                     ;;
                 7)
                     install_devel
                     ;;
                 8)
                     install_tablet
                     ;;
                 9)
                     install_nat_language
                     ;;
                 10)
                     install_MBP
                     ;;
                 11)
                     install_hidpi
                     ;;
                 12)
                     echo "Installing All"
                     install_necessities
                     install_dotfiles
                     install_emacs
                     install_X11
                     install_xmonad
                     install_xfce
                     install_devel
                     install_tablet
                     install_nat-language
                     install_MBP
                     install_hidpi
                     ;;
             esac
         done
