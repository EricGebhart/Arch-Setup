#!/bin/bash

# meta packages
#---------------
# devel - clojure, leiningen, python, perl, etc.
# emacs - emacs, hunspell, languagetool, mu4e, isync, silver-surfer
# mobile-studio-pro  - nvidia, hi DPI settings.
# natural-language - languagetool, hunspell dictionaries,...
# necessities  - basic stuff everyone should have.
# tablet - krita, gimp, cellwriter, easystroke, onboard, Xournal
# X11 - xorg, xorg-apps, ...
# X11-apps - libreoffice, vivaldi, etc.
# Xfce - xfce4, xfce4-goodies, network-manager-applet.
# Xmonad - xmonad, haskell, xfce4-panel, network-manager-applet.

# setup repos.
#----------------
# emacs-setup
# xmonad-setup
# dotfiles
# bc-extensions
# xmonad-log-applet

function install_pkg {
    cd arch-pkgs/$1; makepkg -si; cd -
}

function install_repo {
    cd $1; make ${2 || install}; cd ..
}

function install_xmonad {
    echo "Installing Xmonad and setup"
    install_pkg X11
    install_pkg X11-apps
    install_pkg Xmonad
    install_repo xmonad-setup
    install_repo xmonad-setup xsession
    cd xmonad-log-applet; make && sudo make install; cd -
}


function install_necessities {
    echo "Installing necessities"
    install_pkg necessities
    install_pkg yay

    # install emacs and accomplices
    install_pkg emacs
    # will attempt to copy mu4e site-lisp...
    install_repo emacs-setup all

    # install dotfiles, etc.
    install_repo dotfiles
    install_repo bc-extensions
}

function install_xfce {
    echo "Installing Xfce4"
    install_pkg X11
    install_pkg X11-apps
    install_pkg xfce
}

function install_devel {
    echo "Installing dev tools"
    install_pkg devel
}

function install_tablet {
    echo "Installing dev tools"
    install_pkg tablet
}

function install_nat_language {
    echo "Installing Natural language stuff"
    install_pkg natural-language
}

function install_MBP {
    echo "Installing mobile studio pro, nvidia, hidpi.."
    install_pkg mobile-studio-pro
    install_repo dotfiles hidpi
}

function install_hidpi {
    echo "adding high DPI settings to .Xresources."
    install_repo dotfiles hidpi
}

# create a menu.
cmd=(dialog --separate-output --checklist "Select Packages to install" 22 77 16)
options=(1 "Xmonad" on
         2 "Xfce"   off
         3 "devel"  on
         4 "tablet" off
         5 "natural-language"   on
         6 "mobile-studio-pro"  off
         7 "High DPI screen"    on
         8 "All"    off )

# display menu and get the choices
choices=$("${cmd[@]}" "${options[@]}" 2>@1 >/dev/tty)
# clear

# install necessties always. dotfiles, emacs setup, ~/bin/
install_necessities()

for choice in $choices
do
    case $choice in
        1)
            install_xmonad
            ;;
        2)
            install_xfce
            ;;
        3)
            install_devel
            ;;
        4)
            install_tablet
            ;;
        5)
            install_nat_language
            ;;
        6)
            install_MBP
            ;;
        7)
            install_hidpi
            ;;
        8)
            echo "Installing All"
            install_xmonad
            install_xfce
            install_devel
            install_nat-language
            install_MBP
            install_hidpi
            ;;
    esac
done
